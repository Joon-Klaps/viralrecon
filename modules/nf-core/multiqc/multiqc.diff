Changes in component 'nf-core/multiqc'
Changes in 'multiqc/meta.yml':
--- modules/nf-core/multiqc/meta.yml
+++ modules/nf-core/multiqc/meta.yml
@@ -57,10 +57,10 @@
         - edam: http://edamontology.org/format_3475 # TSV
 output:
   report:
-    - "*.html":
+    - "*multiqc_report.html":
         type: file
         description: MultiQC report file
-        pattern: ".html"
+        pattern: "multiqc_report.html"
         ontologies: []
   data:
     - "*_data":
@@ -72,6 +72,12 @@
         type: file
         description: Plots created by MultiQC
         pattern: "*_data"
+        ontologies: []
+  csv_reports:
+    - "*.csv":
+        type: file
+        description: Summary CSV files created by MultiQC
+        pattern: "*.csv"
         ontologies: []
   versions:
     - versions.yml:

Changes in 'multiqc/main.nf':
--- modules/nf-core/multiqc/main.nf
+++ modules/nf-core/multiqc/main.nf
@@ -15,26 +15,61 @@
     path(sample_names)
 
     output:
-    path "*.html"      , emit: report
-    path "*_data"      , emit: data
-    path "*_plots"     , optional:true, emit: plots
-    path "versions.yml", emit: versions
+    path "*multiqc_report.html", emit: report
+    path "*_data"              , emit: data
+    path "*_plots"             , optional:true, emit: plots
+    path "*.csv"               , optional:true, emit: csv_reports
+    path "versions.yml"        , emit: versions
 
     when:
     task.ext.when == null || task.ext.when
 
     script:
     def args = task.ext.args ?: ''
+    def args2 = task.ext.args2 ?: ''
     def prefix = task.ext.prefix ? "--filename ${task.ext.prefix}.html" : ''
     def config = multiqc_config ? "--config ${multiqc_config}" : ''
     def extra_config = extra_multiqc_config ? "--config ${extra_multiqc_config}" : ''
     def logo = multiqc_logo ? "--cl-config 'custom_logo: \"${multiqc_logo}\"'" : ''
     def replace = replace_names ? "--replace-names ${replace_names}" : ''
     def samples = sample_names ? "--sample-names ${sample_names}" : ''
+    def platform = params.platform
     """
     multiqc \\
         --force \\
         ${args} \\
+        ${config} \\
+        ${prefix} \\
+        ${extra_config} \\
+        ${logo} \\
+        ${replace} \\
+        ${samples} \\
+        .
+
+    ## Parse YAML files dumped by MultiQC to obtain metrics
+    multiqc_to_custom_csv.py --platform $platform
+
+    ## Manually remove files that we don't want in the report
+    if grep -q ">skip_assembly<" multiqc_report.html; then
+        rm -f *assembly_metrics_mqc.csv
+    fi
+
+    if grep -q ">skip_variants<" multiqc_report.html; then
+        rm -f *variants_metrics_mqc.csv
+    fi
+
+    if [ "$platform" = "illumina" ]; then
+        rm -f variants/report.tsv
+    fi
+
+    if [ "$platform" = "nanopore" ]; then
+        rm -rf quast
+    fi
+
+    ## Run MultiQC a second time
+        multiqc \\
+        --force \\
+        ${args2} \\
         ${config} \\
         ${prefix} \\
         ${extra_config} \\

'modules/nf-core/multiqc/environment.yml' is unchanged
'modules/nf-core/multiqc/tests/custom_prefix.config' is unchanged
'modules/nf-core/multiqc/tests/main.nf.test' is unchanged
'modules/nf-core/multiqc/tests/main.nf.test.snap' is unchanged
'modules/nf-core/multiqc/tests/nextflow.config' is unchanged
************************************************************
